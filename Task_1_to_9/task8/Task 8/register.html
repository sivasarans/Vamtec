<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register User</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen block mt-5 m-2 p-4">
    <div class="bg-white p-6 rounded shadow-md w-96">
        <button type="button" class="rounded border-gray-300 bg-gray-500 text-white p-2 mb-4"><a href="main.html">Back</a></button>
        <h2 class="text-2xl font-bold mb-4">Register User</h2>
        <form id="registerForm">
            <!-- Form Fields -->
            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" id="name" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="organization" class="block text-sm font-medium text-gray-700">Organization</label>
                <input type="text" id="organization" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile</label>
                <input type="tel" id="mobile" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="email" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4">
                <label for="numUsers" class="block text-sm font-medium text-gray-700">Number of Users</label>
                <input type="number" id="numUsers" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <!-- Additional fields here -->
            <div class="mb-4">
                <label for="countrySelect" class="block text-sm font-medium text-gray-700">Select Country</label>
                <select id="countrySelect" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
                    <option value="">Choose a country</option>
                </select>
            </div>
            <div class="mb-4">
                <label for="expireDays" class="block text-sm font-medium text-gray-700">Expire Days</label>
                <input type="number" id="expireDays" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
            </div>
            <div class="mb-4" id="stateInputDiv" style="display: none;">
                <label for="stateSelect" class="block text-sm font-medium text-gray-700">Select State</label>
                <select id="stateSelect" class="mt-1 block w-full p-2 border border-gray-300 rounded" required>
                    <option value="">Choose a state</option>
                </select>
            </div>
            <button type="submit" id="submitButton" class="bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600" style="display: none;">Submit</button>
        </form>
    </div>
    <script>
        let dbCountries, dbStates;

        const requestCountries = indexedDB.open("CountryDB", 1);
        

        requestCountries.onsuccess = function(event) {
            dbCountries = event.target.result;
            loadCountries();
        };

        function loadCountries() {
            const transaction = dbCountries.transaction(["countries"], "readonly");
            const objectStore = transaction.objectStore("countries");
            const request = objectStore.getAll();

            request.onsuccess = function(event) {
                const countries = event.target.result;
                const countrySelect = document.getElementById("countrySelect");

                countries.forEach(country => {
                    const option = document.createElement("option");
                    option.value = country.id;
                    option.textContent = country.name;
                    countrySelect.appendChild(option);
                });
            };
        }

        document.getElementById("countrySelect").addEventListener("change", function() {
            const stateInputDiv = document.getElementById("stateInputDiv");
            const submitButton = document.getElementById("submitButton");

            if (this.value) {
                loadStates(this.value);
                stateInputDiv.style.display = "block";
                submitButton.style.display = "block";
            } else {
                stateInputDiv.style.display = "none";
                submitButton.style.display = "none";
            }
        });

        function loadStates(countryId) {
            const requestStates = indexedDB.open("StateDB", 1);

            requestStates.onsuccess = function(event) {
                dbStates = event.target.result;
                const transaction = dbStates.transaction(["states"], "readonly");
                const objectStore = transaction.objectStore("states");
                const index = objectStore.index("countryId");
                const request = index.getAll(countryId);

                const stateSelect = document.getElementById("stateSelect");
                stateSelect.innerHTML = '<option value="">Choose a state</option>';

                request.onsuccess = function(event) {
                    const states = event.target.result;

                    states.forEach(state => {
                        const option = document.createElement("option");
                        option.value = state.id;
                        option.textContent = state.name;
                        stateSelect.appendChild(option);
                    });
                };
            };
        }

        document.getElementById("registerForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const countrySelect = document.getElementById("countrySelect");
            const stateSelect = document.getElementById("stateSelect");

            const expireDays = parseInt(document.getElementById("expireDays").value);
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + expireDays);
            
            const userData = {
                name: document.getElementById("name").value,
                organization: document.getElementById("organization").value,
                mobile: document.getElementById("mobile").value,
                email: document.getElementById("email").value,
                password: document.getElementById("password").value,
                numUsers: document.getElementById("numUsers").value,
                country: countrySelect.options[countrySelect.selectedIndex].text, // Store country name
                expireDays: expireDays,
                expiryDate: expiryDate.toISOString().split('T')[0],
                state: stateSelect.options[stateSelect.selectedIndex]?.text || "" // Store state name
            };

            const requestUsers = indexedDB.open("UserDBSS", 1);
            requestUsers.onupgradeneeded = function(event) {
    const db = event.target.result;
    const objectStore = db.createObjectStore("users", { keyPath: "id", autoIncrement: true }); // Set autoIncrement to true
    // Create indexes if needed
};

            requestUsers.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction(["users"], "readwrite");
                const objectStore = transaction.objectStore("users");
                objectStore.add(userData);
            };

            document.getElementById("registerForm").reset();
            document.getElementById("stateInputDiv").style.display = "none";
            document.getElementById("submitButton").style.display = "none";
        });
    </script>
</body>
</html>
